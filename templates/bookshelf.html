{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Libros</title>
    <meta name="description" content="Lista de libros leídos por Johan con calificaciones, géneros y descripciones.">
    <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">
    <meta property="og:site_name" content="Rincón de Johan">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Mis Libros | Rincón de Johan">
    <meta property="og:description" content="Lista de libros leídos por Johan con calificaciones, géneros y descripciones.">
    <meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">
    <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'Img/library-icon.svg' %}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mis Libros | Rincón de Johan">
    <meta name="twitter:description" content="Lista de libros leídos por Johan con calificaciones, géneros y descripciones.">
    <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'Img/library-icon.svg' %}">
    <link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
</head>
<body class="has-header">
    {% include 'header.html' %}
    
    <div id="book-container" class="book-container" data-has-next="{% if page_obj.has_next %}true{% else %}false{% endif %}">
        {% for book in page_obj %}
        <div class="book-item">
            <div class="book-info-container">
                <!-- Carátula con cursor "manito" y evento de apertura -->
                <div class="book-cover" onclick="openModal('{{ book.id }}')">
                    <img src="{{ MEDIA_URL }}Covers/{{ book.id }}.webp" alt="{{ book.title }}">
                </div>
                
                <!-- Info del libro que se ve al girar la carátula -->
                <div class="book-info">
                    <a href="https://www.goodreads.com{{ book.book_link }}" 
                       class="book-title" 
                       target="_blank">
                       {{ book.title }}
                    </a>
                    <p><strong>Autor</strong><br>{{ book.author }}</p>
                    <p><strong>Mi Calificación</strong><br>
                        {% for _ in "x"|ljust:book.my_rating %}
                            <span class="stars">★</span>
                        {% endfor %}
                    </p>
                    <p><strong>Calificación General</strong><br>{{ book.public_rating }}</p>
                    <p><strong>Lo leí el...</strong><br>{{ book.date_read|date:"d/m/Y" }}</p>
                </div>
            </div>
        </div>
        
        <!-- Modal de la descripción (uno por cada libro) -->
        <div id="modal-{{ book.id }}" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('{{ book.id }}')">&times;</span>
                
                <!-- Aquí podrías repetir la info principal o solo lo que necesites -->
                <h2>{{ book.title }}</h2>
                <p><strong>Autor:</strong> {{ book.author }}</p>
                <p><strong>Mi Calificación</strong> 
                    {% for _ in "x"|ljust:book.my_rating %}
                        <span class="stars">★</span>
                    {% endfor %}
                </p>
                <p><strong>Calificación General:</strong> {{ book.public_rating }}</p>
                <p><strong>Géneros:</strong> {{ book.genres|default:"Sin género" }}</p>
                <p><strong>Lo leí el...</strong> {{ book.date_read|date:"d/m/Y" }}</p>
                
                <!-- Descripción debajo de "Lo leí el..." -->
                <div class="book-description">
                    <strong>Descripción</strong><br><br>
                    {{ book.description|safe }}
                </div>
            </div>
        </div>
        {% endfor %}
        
    </div>

    <div id="loading" style="display: none;">Loading more books...</div>

    <button class="book-scroll-top-btn" id="bookScrollTopBtn" title="Volver arriba" aria-label="Volver arriba">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" aria-hidden="true">
            <path d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.3V480c0 17.7 14.3 32 32 32s32-14.3 32-32V141.3L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"/>
        </svg>
    </button>

    <button class="book-search-btn" id="bookSearchBtn" title="Buscar libros" aria-label="Buscar libros">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-hidden="true">
            <path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/>
        </svg>
    </button>

    <div id="booksSearchModal" class="modal books-search-modal" role="dialog" aria-modal="true" aria-labelledby="booksSearchTitle">
        <div class="modal-content books-search-content">
            <button type="button" class="close books-search-close" id="booksSearchCloseBtn" aria-label="Cerrar">&times;</button>
            <h2 id="booksSearchTitle">Buscar libros</h2>
            <p class="books-search-subtitle">Filtra por título o autor.</p>
            <form id="booksSearchForm" class="books-search-form">
                <input id="booksSearchInput" type="text" class="books-search-input" placeholder="Escribe aquí..." autocomplete="off" value="{{ current_query|default:'' }}">
                <div class="books-search-actions">
                    <button type="submit" class="books-search-apply">Buscar</button>
                    <button type="button" class="books-search-cancel" id="booksSearchCancelBtn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{% static 'js/modal.js' %}"></script>
    <script src="{% static 'js/infinite_scroll.js' %}"></script>
    <script src="{% static 'js/books_scroll_top.js' %}"></script>
    <script src="{% static 'js/books_search.js' %}"></script>
</body>
</html>
